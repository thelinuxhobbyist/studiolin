{{- /* Home main content: Hero, Featured, Latest, Recommended */ -}}

{{- /* Hero Search Section */ -}}
<section class="hero-search">
    <div class="search-container">
        <h1 class="hero-title">Explore the Linux Universe</h1>
        <p class="hero-tagline">{{ site.Params.description }}</p>
        <div style="margin: 2rem 0;">
            <input type="text" id="search-input" placeholder="Search posts and tutorials..."
                   style="width: 70%; padding: 12px; border: 2px solid #059669; border-radius: 4px;">
            <button id="search-btn" type="button" aria-label="Search"
                    style="padding: 12px 20px; background: #059669; color: white; border: none; border-radius: 4px; margin-left: 10px; font-size: 1rem; font-weight: 600;">
                Search
            </button>
        </div>
    </div>
    <script>
    // Search functionality
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        function performSearch() {
            const query = searchInput.value.trim();
            if (query) {
                window.location.href = `/search/?q=${encodeURIComponent(query)}`;
            }
        }
        if (searchBtn) searchBtn.addEventListener('click', performSearch);
        if (searchInput) searchInput.addEventListener('keypress', function(e){ if (e.key === 'Enter') performSearch(); });
    });
    </script>
    <script>
    // Optional trending badge updater (no-op if endpoint missing)
    (function(){
        async function fetchTrending(){
            try {
                const res = await fetch('/.netlify/functions/views');
                if (!res.ok) throw new Error('no views');
                const data = await res.json();
                const map = {};
                data.forEach(d => { map[d.key.replace(/\/$/, '')] = d.views; });
                document.querySelectorAll('.recommended-card').forEach(card => {
                    const a = card.querySelector('h4 a');
                    if (!a) return;
                    const path = a.pathname.replace(/\/$/, '');
                    const views = map[path];
                    if (views) {
                        let v = card.querySelector('.views');
                        if (!v) { v = document.createElement('div'); v.className = 'views'; card.querySelector('.card-body').appendChild(v); }
                        v.innerHTML = `<i class="fas fa-eye"></i> ${views} views`;
                        const label = card.querySelector('.label');
                        if (label) { label.classList.add('trending'); label.classList.remove('editor'); label.innerText = 'üî• Trending'; }
                    }
                });
            } catch (e) { console.debug('live trending unavailable', e); }
        }
        if (window.fetch) fetchTrending();
    })();
    </script>
</section>

{{- /* Editorial Context Section */ -}}
<section class="editorial-context">
    <div class="context-container">
        <h2>What is StudioLinux?</h2>
        <p>Linux is everywhere‚Äîfrom government infrastructure and education systems to enterprise data centers and your smart home devices. Yet most people don't realize how deeply it shapes their daily lives.</p>
        <p>StudioLinux explores this invisible impact through in-depth articles, hands-on tutorials, and real-world case studies. Whether you're a seasoned developer or just curious about technology, you'll find content that helps you understand and master Linux.</p>
        <div class="context-pillars">
            <div class="context-item">
                <h4><a href="/linux-in-government/">Government & Policy</a></h4>
                <p>How nations build digital sovereignty through open-source infrastructure</p>
            </div>
            <div class="context-item">
                <h4><a href="/linux-in-education/">Education & Learning</a></h4>
                <p>Empowering students and institutions with free, powerful tools</p>
            </div>
            <div class="context-item">
                <h4><a href="/linux-in-enterprise/">Enterprise & Business</a></h4>
                <p>The backbone of modern cloud, DevOps, and critical infrastructure</p>
            </div>
            <div class="context-item">
                <h4><a href="/linux-in-community/">Community & Open Source</a></h4>
                <p>The collaborative movement driving technology forward</p>
            </div>
            <div class="context-item">
                <h4><a href="/linux-in-everyday-life/">Everyday Life & Computing</a></h4>
                <p>Smart homes, personal devices, and real-world applications</p>
            </div>
        </div>
    </div>
    <style>
        .editorial-context {
            background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);
            border-top: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
            padding: 3rem 1rem;
            margin: 2rem 0;
        }
        
        .context-container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .editorial-context h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #0f172a;
            text-align: center;
        }
        
        .editorial-context > div > p {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #475569;
            margin-bottom: 1.5rem;
            text-align: center;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .context-pillars {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .context-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.2s ease;
        }
        
        .context-item:hover {
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
            border-color: #2563eb;
            transform: translateY(-2px);
        }
        
        .context-item h4 {
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .context-item h4 a {
            color: #2563eb;
            text-decoration: none;
            transition: color 0.2s ease;
        }
        
        .context-item h4 a:hover {
            color: #1d4ed8;
            text-decoration: underline;
        }
        
        .context-item p {
            font-size: 0.9rem;
            color: #64748b;
            margin: 0;
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .editorial-context {
                padding: 2rem 1rem;
            }
            
            .editorial-context h2 {
                font-size: 1.5rem;
            }
            
            .editorial-context > div > p {
                font-size: 1rem;
            }
            
            .context-pillars {
                grid-template-columns: 1fr;
            }
        }
    </style>
</section>

{{- /* Featured Article Section - prioritizes published_on_home flag */ -}}
{{- $now := now }}
{{- /* Query ALL articles from entire site, not just specific sections */ -}}
{{- $allArticles := .Site.RegularPages }}
{{- /* Filter out utility/admin pages */ -}}
{{- $publishedArticles := where $allArticles "Date" "le" $now }}
{{- $validArticles := slice }}
{{- range $publishedArticles }}
  {{- $isUtility := or (eq .Layout "search") (eq .Type "search") (in (slice "privacy" "terms" "about" "contact" "resources" "linux-in-government" "linux-in-education" "linux-in-enterprise" "linux-in-community" "linux-in-everyday-life") (lower .File.BaseFileName)) }}
  {{- if not $isUtility }}
    {{- $validArticles = $validArticles | append . }}
  {{- end }}
{{- end }}
{{- /* First try to find explicitly featured articles */ -}}
{{- $homeFeatures := where $validArticles "Params.published_on_home" true }}
{{- /* Fall back to most recent if no explicit featured article */ -}}
{{- $featured := cond (gt (len $homeFeatures) 0) (first 1 $homeFeatures) (first 1 ($validArticles.ByDate.Reverse)) }}
{{- if gt (len $featured) 0 }}
{{- range $featured }}
<section class="featured-article">
    <div class="section-header">
        <h2>Featured Article</h2>
    </div>
    <article class="featured-card">
        <div class="featured-image">
            {{- partial "featured-image.html" (dict "page" . "class" "featured-img" "alt" .Title) }}
        </div>
        <div class="featured-content">
            <div class="featured-meta">
                <span class="category">{{ .Section | title }}</span>
                <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "January 2, 2006" }}</time>
            </div>
            <h3><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
            <p class="featured-summary">{{ .Summary | plainify | truncate 150 }}</p>
            <a href="{{ .Permalink }}" class="read-more-btn">Read More</a>
        </div>
    </article>
    </section>
{{- end }}
{{- end }}

{{- /* Latest Posts Section */ -}}
<section class="latest-posts">
    <div class="section-header">
        <h2>Latest Content</h2>
    </div>
    <div class="posts-grid" id="homepagePosts">
        {{- /* Query ALL posts from entire site */ -}}
        {{- /* Blacklist: exclude pages that shouldn't appear in latest posts */ -}}
        {{- $blacklist := slice "privacy" "terms" "about" "contact" "search" "resources" "linux-in-government" "linux-in-education" "linux-in-enterprise" "linux-in-community" "linux-in-everyday-life" }}
        {{- $posts := where $allArticles "Date" "le" $now }}
        {{- range $posts.ByDate.Reverse }}
        {{- if not (in $blacklist (lower .File.BaseFileName)) }}
        <article class="post-card" data-category="{{ with .Params.categories }}{{ if gt (len .) 0 }}{{ index . 0 }}{{ else }}{{ $.Section | title }}{{ end }}{{ else }}{{ .Section | title }}{{ end }}" data-tags="{{ with .Params.tags }}{{ delimit . "," }}{{ end }}">
            <div class="card-image">
                <img src="{{ with .Params.thumbnail }}{{ . }}{{ else }}{{ with .Params.image }}{{ . }}{{ else }}/images/default-post.svg{{ end }}{{ end }}" alt="{{ .Title }}" loading="lazy" />
            </div>
            <div class="card-meta">
                <span class="category">{{ .Section | title }}</span>
                <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "Jan 2, 2006" }}</time>
            </div>
            <h3><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
            <p class="card-summary">{{ with .Summary }}{{ . | plainify | truncate 100 }}{{ end }}</p>
            <div class="card-footer">
                <a href="{{ .Permalink }}" class="read-more">Read More</a>
                <span class="reading-time"><i class="far fa-clock"></i> {{ .ReadingTime }} min read</span>
            </div>
        </article>
        {{- end }}
        {{- end }}
    </div>
</section>

{{- /* Recommended Reads Section */ -}}
<section class="recommended-reads">
    <div class="section-header">
        <h2>Recommended Reads</h2>
        <p>Hand-picked guides and posts for getting started and leveling up.</p>
    </div>
    <div class="path-grid recommended-grid">
        {{- /* Query ALL articles from entire site for recommendations */ -}}
        {{- $editorPicks := where $publishedArticles "Params.recommended" "eq" "editor" }}
        {{- $recommendedPosts := first 4 $editorPicks }}
        {{- if eq (len $recommendedPosts) 0 }}
            {{- /* Fallback: if no editor picks, show 4 latest articles from any section */ -}}
            {{- $recommendedPosts = first 4 ($publishedArticles.ByDate.Reverse) }}
        {{- end }}
        {{- range $recommendedPosts -}}
        <article class="path-card recommended-card">
            <div class="card-image">
                <img src="{{ with .Params.thumbnail }}{{ . }}{{ else }}{{ with .Params.image }}{{ . }}{{ else }}/images/default-post.svg{{ end }}{{ end }}" alt="{{ .Title }}" loading="lazy" />
            </div>
            <div class="card-body">
                <div class="label editor">‚≠ê Editor's Pick</div>
                <h4><a href="{{ .Permalink }}">{{ .Title }}</a></h4>
                <p>{{ with .Summary }}{{ . | plainify | truncate 120 }}{{ end }}</p>
            </div>
            <div class="card-footer">
                <a href="{{ .Permalink }}" class="read-more">Read More</a>
                <span class="reading-time"><i class="far fa-clock"></i> {{ .ReadingTime }} min read</span>
            </div>
        </article>
        {{- end -}}
    </div>
</section>

<script src="/js/home-filters.js"></script>
<script src="/js/home-pagination.js"></script>
