{{- define "main" }}

{{- /* Hero Search Section */ -}}
<section class="hero-search">
    <div class="search-container">
        <h1 class="hero-title">Explore the Linux Universe</h1>
        <p class="hero-tagline">{{ site.Params.description }}</p>
        <div style="margin: 2rem 0;">
            <input type="text" id="search-input" placeholder="Search posts and tutorials..." 
                   style="width: 70%; padding: 12px; border: 2px solid #059669; border-radius: 4px;">
            <button id="search-btn" type="button" aria-label="Search" 
                    style="padding: 12px 20px; background: #059669; color: white; border: none; border-radius: 4px; margin-left: 10px; font-size: 1rem; font-weight: 600;">
                Search
            </button>
        </div>
    </div>
</section>

{{- /* Featured Article Section */ -}}
{{- $featured := first 1 (where .Site.RegularPages "Section" "posts") }}
{{- if gt (len $featured) 0 }}
{{- range $featured }}
<section class="featured-article">
    <div class="section-header">
        <h2>Featured Article</h2>
    </div>
    <article class="featured-card">
        <div class="featured-image">
            {{- if .Params.image }}
            <img src="{{ .Params.image }}" alt="{{ .Title }}" />
            {{- else }}
            <img src="/images/default-post.svg" alt="Studio{Linux} Featured Article" />
            {{- end }}
        </div>
        <div class="featured-content">
            <div class="featured-meta">
                <span class="category"><i class="fas fa-star"></i> {{ .Section | title }}</span>
                <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "January 2, 2006" }}</time>
            </div>
            <h3><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
            <p class="featured-summary">{{ .Summary | plainify | truncate 150 }}</p>
            <a href="{{ .Permalink }}" class="read-more-btn">Read More</a>
        </div>
    </article>
</section>
{{- end }}
{{- end }}

{{- /* Latest Posts Section */ -}}
<section class="latest-posts">
    <div class="section-header">
        <h2>Latest Content</h2>
    </div>
    <div class="filters-row">
        <div class="category-tabs" role="tablist" aria-label="Filter posts">
            <button data-cat="all" class="tab active">All</button>
            <button data-cat="Tutorials" class="tab">Tutorials</button>
            <button data-cat="News" class="tab">News</button>
            <button data-cat="Reviews" class="tab">Reviews</button>
            <button data-cat="Opinion" class="tab">Opinion</button>
        </div>
        <div class="tag-cloud">
            {{/* We'll populate tags JS side. */}}
        </div>
    </div>
    <div class="posts-grid" id="homepagePosts">
        {{- $posts := (where .Site.RegularPages "Section" "posts") }}
        {{- range $posts }}
        <article class="post-card" data-category="{{- with .Params.categories -}}{{ index . 0 }}{{ else }}{{ .Section }}{{ end }}" data-tags="{{ delimit .Params.tags "," }}">
            <div class="card-image">
                <img src="{{ .Params.image | default "/images/default-post.svg" }}" alt="{{ .Title }}" />
            </div>
            <div class="card-meta">
                <span class="category"><i class="fas fa-folder"></i> {{ .Section | title }}</span>
                <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "Jan 2" }}</time>
            </div>
            <h3><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
            <p class="card-summary">{{ .Summary | plainify | truncate 100 }}</p>
            <div class="card-footer">
                <a href="{{ .Permalink }}" class="read-more">Read More</a>
                <span class="reading-time"><i class="far fa-clock"></i> {{ .ReadingTime }} min read</span>
            </div>
        </article>
        {{- end }}
    </div>
    <div class="pagination-controls" style="text-align:center; margin-top:1rem;">
        <button id="loadMoreBtn" class="load-more">Load more</button>
    </div>
</section>

{{- /* Learning Paths Section */ -}}
<section class="learning-paths">
    <div class="section-header">
        <h2>Learning Paths</h2>
    </div>
    <div class="path-grid">
        <div class="path-card">
            <h4><a href="/?category=Tutorials">Getting Started with Linux</a></h4>
            <p>Core tutorials for beginners to get comfortable with Linux.</p>
        </div>
        <div class="path-card">
            <h4><a href="/?category=SysAdmin">Intermediate SysAdmin Skills</a></h4>
            <p>Build out your system admin toolkit and best practices.</p>
        </div>
        <div class="path-card">
            <h4><a href="/?category=Automation">Automation & DevOps</a></h4>
            <p>Learn automation workflows, CI/CD, and containerization.</p>
        </div>
        <div class="path-card">
            <h4><a href="/?category=Development">Linux for Developers</a></h4>
            <p>Developer-focused guides, tools, and workflows for Linux.</p>
        </div>
    </div>
</section>

<script>
// Search functionality
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const searchBtn = document.getElementById('search-btn');

    function performSearch() {
        const query = searchInput.value.trim();
        if (query) {
            // Redirect to search page with query parameter
            window.location.href = `/search/?q=${encodeURIComponent(query)}`;
        }
    }

    // Handle search button click
    if (searchBtn) {
        searchBtn.addEventListener('click', performSearch);
    }

    // Handle Enter key press in search input
    if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
    }

    // Intercept learning path links to apply category filters without reload
    document.querySelectorAll('.path-card a').forEach(a => {
        a.addEventListener('click', function(e) {
            e.preventDefault();
            const params = new URLSearchParams(window.location.search);
            const cat = new URL(a.href).searchParams.get('category');
            if (cat) {
                params.set('category', cat);
                // Update URL and set local storage
                history.replaceState({}, '', `${window.location.pathname}?${params.toString()}`);
                localStorage.setItem('homepage-category', cat);
                // Trigger filters
                if (window.dispatchEvent) {
                    window.dispatchEvent(new Event('category-change'));
                }
                // Scroll to filters
                const el = document.querySelector('.filters-row');
                if (el) el.scrollIntoView({ behavior: 'smooth' });
            }
        });
    });
});
</script>

<script src="/js/home-filters.js"></script>
<script src="/js/home-pagination.js"></script>

{{- end }}